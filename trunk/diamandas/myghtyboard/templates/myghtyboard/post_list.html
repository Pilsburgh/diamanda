{% extends "pages/body.html" %}
{% load i18n %}
{% load fbc %}
{% load pyif %}

{% block title %}{{ forum_name }} - {{ topic }}{% endblock %}
{% block header %}{{ forum_name }} - {{ topic }}{% endblock %}
{% block crumb %}<a href="/">{% trans "Home" %}</a> > <a href="/forum/">{% trans "Forum Index" %}</a> > <a href="/forum/forum/{{ forum_id }}/">{{ forum_name }}</a> > <a href="/forum/topic/1/{{ topic_id }}">{{ topic }}</a>{% endblock %}

{% block pagemenu %}
	{% if opened %}
		<li><a href="/forum/add_post/{{ topic_id }}/">{% trans "Add Post" %}</a></li>
	{% endif %}
	<li><a href="/forum/">{% trans "Back to Forum" %}</a></li>
	<li><a href="/forum/lasttopics/">{% trans "Last Active Topics" %}</a></li>
	<li><a href="/forum/mytopics/">{% trans "My Topics" %}</a></li>
	<li><a href="/forum/myptopics/">{% trans "My Posts" %}</a></li>
{% endblock %}

{% block content %}

	{% for i in object_list %}
	{% pyif user.get_profile.onsitedata < i.post_date %}<a name="new"></a>{% endif %}
	<div class="post">
		    <div class="posthead">{{ i.post_date|date:"d.m.Y" }}</div>
		    <div class="leftpost">
			      <strong>{{ i.post_author}}</strong>
		    </div>
		    <div class="rightpost">
			      {{ i.post_text|fbc|safe|urlizetrunc:"60" }}
		    </div>
		    <div class="leftbottompost">
			      {% if perms.is_staff %}{{ i.post_ip }}{% endif %}
		    </div>
		    <div class="rightbottompost">
			      {% if perms.add_post %}
				      {% if opened %}
					      <a href="/forum/add_post/{{ topic_id }}/{{ i.id }}/" class="quote">{% trans "Reply with quote" %}</a>
				      {% endif %}
			      {% endif %}
			      {% ifequal i.post_author current_user %}
				      {% if opened %}
					      {% ifnotequal i.post_author "AnonymousUser" %}
						      <a href="/forum/edit_post/{{ i.id }}/" class="edit">{% trans "Edit this post" %}</a>
					      {% endifnotequal %}
				      {% endif %} 
			      {% else %}
				      {% if perms.is_staff %}
					      <a href="/forum/edit_post/{{ i.id }}/" class="edit">{% trans "Edit this post" %}</a>
				      {% endif %}
			      {% endifequal %}
			      {% if perms.is_staff %}
					<a href="/forum/delete_post/{{ i.id }}/{{ topic_id }}/" onclick="return confirm('{% trans "Delete This Post?" %}')" class="delete">{% trans "Delete this post" %}</a>
			      {% endif %}
		    </div>
	</div>
	<br />
	{% endfor %}

{% ifnotequal pages 1 %}
	<div class="box">
			<div style="text-align:center;">
			{% ifnotequal pages 0 %}
			{% ifnotequal pages 1 %}
			<a href="/forum/topic/1/{{ topic_id }}/"><b>{% trans "First Page" %}</b></a> | 
			{% endifnotequal %}
			{% endifnotequal %}
			
			{% if has_previous %}
				<a href="/forum/topic/{{ previous }}/{{ topic_id }}/"><b>{% trans "Previous Page" %} </b></a>
			{% endif %}
			
			{% if has_next %}
			<a href="/forum/topic/{{ next }}/{{ topic_id }}/"><b> {% trans "Next Page" %}</b></a>
			{% endif %}
			
			{% ifnotequal pages 0 %}
			{% ifnotequal pages 1 %}
			 | <a href="/forum/topic/{{ pages }}/{{ topic_id }}/"><b>{% trans "Last Page" %}</b></a>
			{% endifnotequal %}
			{% endifnotequal %}
			</div>
	</div>
{% endifnotequal %}

{% if perms.add_post %}
{% if opened %}
<form method="post" action="/forum/add_post/{{ topic_id }}/">
<div class="postform">
        <div class="posthead">{% trans "Add new post" %}</div>
        <div class="leftpostform">
		<strong>{% trans "Content" %}</strong>
	</div>
	<div class="rightpostform">	
	      <textarea name="post_text" id="id_text" onkeyup="fit_textarea(this);" rows="6">{{ post_text }}</textarea>
	</div>
        <div class="leftpostform">
	</div>
	<div class="rightpostform">	
                <input type="submit" value="{% trans "Add post" %}" />
	</div>
    </div>
</form>
{% endif %}{% endif %}

<p style="text-align:right;"><br />
	{% if perms.add_topic %}
		{% trans "You <b>can</b> post new Topics" %}<br />
	{% else %}
		{% trans "You <b>can't</b> post new Topics" %}<br />
	{% endif %}
	{% if perms.add_post %}
		{% trans "You <b>can</b> post new Posts" %}<br />
	{% else %}
		{% trans "You <b>can't</b> post new Posts" %}<br />
	{% endif %}
	{% if perms.is_staff %}
		{% trans "You <b>are</b> a Moderator" %}<br />
	{% else %}
		{% trans "You <b>aren't</b> a moderator" %}<br />
	{% endif %}
	</p>
{% endblock %}